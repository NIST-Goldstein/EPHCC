<RTACModule>
  <POU>
    <ExportSource>
      <Schema>20</Schema>
      <DeviceMOT>3530</DeviceMOT>
    </ExportSource>
    <Name>HMI1_Proc</Name>
    <POUKind>Program</POUKind>
    <Content>
      <Interface><![CDATA[PROGRAM HMI1_Proc
VAR
	aCB   : ARRAY [1..47] OF CB := 
			   [
(ID:=1,CBID:=301,Flow:=ADR(HMI1.Flow_301),Status:=ADR(HMI1.CB301_Closed),IOCCmd:=ADR(HMI1.CB301_Cmd),MBCmd:=ADR(CB301_MODBUS.CMD),MBRst:=ADR(CB301_MODBUS.RST)),
(ID:=2,CBID:=302,Flow:=ADR(HMI1.Flow_302),Status:=ADR(HMI1.CB302_Closed),IOCCmd:=ADR(HMI1.CB302_Cmd),MBCmd:=ADR(CB302_MODBUS.CMD),MBRst:=ADR(CB302_MODBUS.RST)),
(ID:=3,CBID:=303,Flow:=ADR(HMI1.Flow_303),Status:=ADR(HMI1.CB303_Closed),IOCCmd:=ADR(HMI1.CB303_Cmd),MBCmd:=ADR(CB303_MODBUS.CMD),MBRst:=ADR(CB303_MODBUS.RST)),
(ID:=4,CBID:=304,Flow:=ADR(HMI1.Flow_304),Status:=ADR(HMI1.CB304_Closed),IOCCmd:=ADR(HMI1.CB304_Cmd),MBCmd:=ADR(CB304_MODBUS.CMD),MBRst:=ADR(CB304_MODBUS.RST)),
(ID:=5,CBID:=305,Flow:=ADR(HMI1.Flow_305),Status:=ADR(HMI1.CB305_Closed),IOCCmd:=ADR(HMI1.CB305_Cmd),MBCmd:=ADR(CB305_MODBUS.CMD),MBRst:=ADR(CB305_MODBUS.RST)),
(ID:=6,CBID:=306,Flow:=ADR(HMI1.Flow_306),Status:=ADR(HMI1.CB306_Closed)),
(ID:=7,CBID:=307,Flow:=ADR(HMI1.Flow_307),Status:=ADR(HMI1.CB307_Closed)),
(ID:=8,CBID:=308,Flow:=ADR(HMI1.Flow_308),Status:=ADR(HMI1.CB308_Closed)),
(ID:=9,CBID:=309,Flow:=ADR(HMI1.Flow_309),Status:=ADR(HMI1.CB309_Closed)),
(ID:=10,CBID:=201,Flow:=ADR(HMI1.Flow_201),Status:=ADR(HMI1.CB201_Closed),IOCCmd:=ADR(HMI1.CB201_Cmd),MBCmd:=ADR(CB201_MODBUS.CMD),MBRst:=ADR(CB201_MODBUS.RST)),
(ID:=11,CBID:=202,Flow:=ADR(HMI1.Flow_202),Status:=ADR(HMI1.CB202_Closed),IOCCmd:=ADR(HMI1.CB202_Cmd),MBCmd:=ADR(CB202_MODBUS.CMD),MBRst:=ADR(CB202_MODBUS.RST)),
(ID:=12,CBID:=203,Flow:=ADR(HMI1.Flow_203),Status:=ADR(HMI1.CB203_Closed),IOCCmd:=ADR(HMI1.CB203_Cmd),MBCmd:=ADR(CB203_MODBUS.CMD),MBRst:=ADR(CB203_MODBUS.RST)),
(ID:=13,CBID:=204,Flow:=ADR(HMI1.Flow_204),Status:=ADR(HMI1.CB204_Closed)),
(ID:=14,CBID:=205,Flow:=ADR(HMI1.Flow_205),Status:=ADR(HMI1.CB205_Closed)),
(ID:=15,CBID:=206,Flow:=ADR(HMI1.Flow_206),Status:=ADR(HMI1.CB206_Closed)),
(ID:=16,CBID:=207,Flow:=ADR(HMI1.Flow_207),Status:=ADR(HMI1.CB207_Closed)),
(ID:=17,CBID:=208,Flow:=ADR(HMI1.Flow_208),Status:=ADR(HMI1.CB208_Closed)),
(ID:=18,CBID:=209,Flow:=ADR(HMI1.Flow_209),Status:=ADR(HMI1.CB209_Closed)),
(ID:=19,CBID:=210,Flow:=ADR(HMI1.Flow_210),Status:=ADR(HMI1.CB210_Closed)),
(ID:=20,CBID:=211,Flow:=ADR(HMI1.Flow_211),Status:=ADR(HMI1.CB211_Closed)),
(ID:=21,CBID:=212,Flow:=ADR(HMI1.Flow_212),Status:=ADR(HMI1.CB212_Closed)),
(ID:=22,CBID:=213,Flow:=ADR(HMI1.Flow_213),Status:=ADR(HMI1.CB213_Closed),IOCCmd:=ADR(HMI1.CB213_Cmd),MBCmd:=ADR(CB213_MODBUS.CMD),MBRst:=ADR(CB213_MODBUS.RST)),
(ID:=23,CBID:=214,Flow:=ADR(HMI1.Flow_214),Status:=ADR(HMI1.CB214_Closed)),
(ID:=24,CBID:=215,Flow:=ADR(HMI1.Flow_215),Status:=ADR(HMI1.CB215_Closed)),
(ID:=25,CBID:=216,Flow:=ADR(HMI1.Flow_216),Status:=ADR(HMI1.CB216_Closed),IOCCmd:=ADR(HMI1.CB216_Cmd),MBCmd:=ADR(CB216_MODBUS.CMD),MBRst:=ADR(CB216_MODBUS.RST)),
(ID:=26,CBID:=217,Flow:=ADR(HMI1.Flow_217),Status:=ADR(HMI1.CB217_Closed),IOCCmd:=ADR(HMI1.CB217_Cmd),MBCmd:=ADR(CB217_MODBUS.CMD),MBRst:=ADR(CB217_MODBUS.RST)),
(ID:=27,CBID:=218,Flow:=ADR(HMI1.Flow_218),Status:=ADR(HMI1.CB218_Closed)),
(ID:=28,CBID:=219,Flow:=ADR(HMI1.Flow_219),Status:=ADR(HMI1.CB219_Closed)),
(ID:=29,CBID:=101,Flow:=ADR(HMI1.Flow_101),Status:=ADR(HMI1.CB101_Closed),IOCCmd:=ADR(HMI1.CB101_Cmd),MBCmd:=ADR(CB101_MODBUS.CMD),MBRst:=ADR(CB101_MODBUS.RST)),
(ID:=30,CBID:=102,Flow:=ADR(HMI1.Flow_102),Status:=ADR(HMI1.CB102_Closed),IOCCmd:=ADR(HMI1.CB102_Cmd),MBCmd:=ADR(CB102_MODBUS.CMD),MBRst:=ADR(CB102_MODBUS.RST)),
(ID:=31,CBID:=103,Flow:=ADR(HMI1.Flow_103),Status:=ADR(HMI1.CB103_Closed),IOCCmd:=ADR(HMI1.CB103_Cmd),MBCmd:=ADR(CB103_MODBUS.CMD),MBRst:=ADR(CB103_MODBUS.RST)),
(ID:=32,CBID:=104,Flow:=ADR(HMI1.Flow_104),Status:=ADR(HMI1.CB104_Closed)),
(ID:=33,CBID:=105,Flow:=ADR(HMI1.Flow_105),Status:=ADR(HMI1.CB105_Closed)),
(ID:=34,CBID:=106,Flow:=ADR(HMI1.Flow_106),Status:=ADR(HMI1.CB106_Closed)),
(ID:=35,CBID:=107,Flow:=ADR(HMI1.Flow_107),Status:=ADR(HMI1.CB107_Closed)),
(ID:=36,CBID:=108,Flow:=ADR(HMI1.Flow_108),Status:=ADR(HMI1.CB108_Closed),IOCCmd:=ADR(HMI1.CB108_Cmd),MBCmd:=ADR(CB108_MODBUS.CMD),MBRst:=ADR(CB108_MODBUS.RST)),
(ID:=37,CBID:=109,Flow:=ADR(HMI1.Flow_109),Status:=ADR(HMI1.CB109_Closed),IOCCmd:=ADR(HMI1.CB109_Cmd),MBCmd:=ADR(CB109_MODBUS.CMD),MBRst:=ADR(CB109_MODBUS.RST)),
(ID:=38,CBID:=110,Flow:=ADR(HMI1.Flow_110),Status:=ADR(HMI1.CB110_Closed)),
(ID:=39,CBID:=111,Flow:=ADR(HMI1.Flow_111),Status:=ADR(HMI1.CB111_Closed),IOCCmd:=ADR(HMI1.CB111_Cmd),MBCmd:=ADR(CB111_MODBUS.CMD),MBRst:=ADR(CB111_MODBUS.RST)),
(ID:=40,CBID:=112,Flow:=ADR(HMI1.Flow_112),Status:=ADR(HMI1.CB112_Closed)),
(ID:=41,CBID:=113,Flow:=ADR(HMI1.Flow_113),Status:=ADR(HMI1.CB113_Closed),IOCCmd:=ADR(HMI1.CB113_Cmd),MBCmd:=ADR(CB113_MODBUS.CMD),MBRst:=ADR(CB113_MODBUS.RST)),
(ID:=42,CBID:=114,Flow:=ADR(HMI1.Flow_114),Status:=ADR(HMI1.CB114_Closed)),
(ID:=43,CBID:=300,Flow:=ADR(HMI1.Flow_300),Status:=ADR(HMI1.CB300_Closed)),
(ID:=44,CBID:=200,Flow:=ADR(HMI1.Flow_200),Status:=ADR(HMI1.CB200_Closed)),
(ID:=45,CBID:=100,Flow:=ADR(HMI1.Flow_100),Status:=ADR(HMI1.CB100_Closed)),
(ID:=46,CBID:=351,Flow:=ADR(HMI1.Flow_351),Status:=ADR(HMI1.CB351_Closed)),
(ID:=47,CBID:=151,Flow:=ADR(HMI1.Flow_151),Status:=ADR(HMI1.CB151_Closed))

];
	kWMax : REAL := 30000/100;
	ii : UINT;
	CB_cmd : UINT;
	CB_rst : UINT;
	MBUS_ENA : BOOL := TRUE;
	
END_VAR
]]></Interface>
      <Implementation><![CDATA[FOR ii:=1 TO 47 BY 1 DO
	aCB[ii].Flow^.instMag := INT_TO_REAL(UDPOpalRead.i16_Raw[UDPOpalRead.REAL_ID + aCB[ii].ID - 1])/kWMax;
	aCB[ii].Flow^.q.validity := UDPOpalRead.bWdgDataValid;
	aCB[ii].Status^.stVal := INT_TO_BOOL(UDPOpalRead.i16_Raw[UDPOpalRead.STATUS_ID + aCB[ii].ID - 1]);
	aCB[ii].Status^.q.validity := UDPOpalRead.bWdgDataValid;
	IF aCB[ii].IOCCmd <> 0 THEN
		IF aCB[ii].IOCCmd^.operPulse.ctlVal = TRUE THEN
			IF aCB[ii].Status^.stVal = TRUE THEN
				CB_cmd := 2;
			ELSE
				CB_cmd := 0;
			END_IF
		ELSIF aCB[ii].IOCCmd^.operSet.ctlVal = TRUE THEN
			CB_cmd := 1;
		ELSIF aCB[ii].IOCCmd^.operClear.ctlVal = TRUE THEN
			CB_rst := 1;
		ELSE
			CB_cmd := 5;
			CB_rst := 0;
		END_IF
		aCB[ii].MBCmd^.oper.q.validity := validity_t.good;
		aCB[ii].MBRst^.oper.q.validity := validity_t.good;
		aCB[ii].MBCmd^.oper.trigger := (aCB[ii].MBCmd^.oper.ctlVal<>UINT_TO_DINT(CB_cmd));
		aCB[ii].MBRst^.oper.trigger := (aCB[ii].MBRst^.oper.ctlVal<>UINT_TO_DINT(CB_rst));
		aCB[ii].MBCmd^.oper.ctlVal := CB_cmd;
		aCB[ii].MBRst^.oper.ctlVal := CB_rst;
			
	END_IF
END_FOR

CB101_MODBUS_POU.EN := MBUS_ENA;
CB102_MODBUS_POU.EN := MBUS_ENA;
CB103_MODBUS_POU.EN := MBUS_ENA;
CB108_MODBUS_POU.EN := MBUS_ENA;
CB109_MODBUS_POU.EN := MBUS_ENA;
CB111_MODBUS_POU.EN := MBUS_ENA;
CB113_MODBUS_POU.EN := MBUS_ENA;
CB201_MODBUS_POU.EN := MBUS_ENA;
CB202_MODBUS_POU.EN := MBUS_ENA;
CB203_MODBUS_POU.EN := MBUS_ENA;
CB213_MODBUS_POU.EN := MBUS_ENA;
CB216_MODBUS_POU.EN := MBUS_ENA;
CB217_MODBUS_POU.EN := MBUS_ENA;
CB301_MODBUS_POU.EN := MBUS_ENA;
CB302_MODBUS_POU.EN := MBUS_ENA;
CB303_MODBUS_POU.EN := MBUS_ENA;
CB304_MODBUS_POU.EN := MBUS_ENA;
CB305_MODBUS_POU.EN := MBUS_ENA;
]]></Implementation>
    </Content>
  </POU>
</RTACModule>